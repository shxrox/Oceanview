<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body { font-family: sans-serif; background: #f4f6f7; padding: 20px; }
    .wrapper { max-width: 1200px; margin: 0 auto; }
    .header { display: flex; justify-content: space-between; margin-bottom: 20px; }
    .chart-row { display: flex; gap: 20px; margin-bottom: 30px; }
    .chart-box { flex: 1; background: white; padding: 20px; height: 300px; border-radius: 8px; }

    table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
    th { background: #2c3e50; color: white; padding: 12px; text-align: left; }
    td { padding: 12px; border-bottom: 1px solid #eee; }
    .btn { background: #8e44ad; color: white; padding: 5px 10px; border: none; cursor: pointer; border-radius: 3px; }
    .logout { background: #e74c3c; color: white; text-decoration: none; padding: 10px 20px; border-radius: 4px; }
  </style>
</head>
<body>

<div class="wrapper">
  <div class="header">
    <h2>ðŸ“Š Administrator Dashboard</h2>
    <a href="#" onclick="logout()" class="logout">Logout</a>
  </div>

  <div class="chart-row">
    <div id="piechart" class="chart-box">Loading...</div>
    <div id="barchart" class="chart-box">Loading...</div>
  </div>

  <h3>ðŸ“‘ Recent Invoices</h3>
  <table id="invTable">
    <thead><tr><th>ID</th><th>Guest</th><th>Room</th><th>Dates</th><th>Action</th></tr></thead>
    <tbody id="tbody"><tr><td colspan="5">Loading data...</td></tr></tbody>
  </table>
</div>

<script>
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(loadData);

  async function loadData() {
    const res = await fetch('adminData');
    const data = await res.json();

    // 1. Pie Chart
    var pie = new google.visualization.DataTable();
    pie.addColumn('string', 'Type'); pie.addColumn('number', 'Count');
    data.pieData.forEach(d => pie.addRow([d.type, d.count]));
    new google.visualization.PieChart(document.getElementById('piechart')).draw(pie, {title:'Room Occupancy'});

    // 2. Bar Chart
    var bar = new google.visualization.DataTable();
    bar.addColumn('string', 'Type'); bar.addColumn('number', 'Revenue');
    data.barData.forEach(d => bar.addRow([d.type, d.revenue]));
    new google.visualization.ColumnChart(document.getElementById('barchart')).draw(bar, {title:'Total Revenue ($)', legend: 'none'});

    // 3. Table
    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';
    data.invoices.forEach(i => {
      tbody.innerHTML += `
                <tr>
                    <td>#${i.id}</td><td>${i.customer}</td><td>${i.room}</td>
                    <td>${i.checkIn} to ${i.checkOut}</td>
                    <td><button class="btn" onclick="printInv(${i.id}, '${i.customer}', '${i.room}', '${i.checkIn}', '${i.checkOut}', ${i.price})">ðŸ“„ Invoice</button></td>
                </tr>`;
    });
  }

  function printInv(id, name, room, inDate, outDate, price) {
    const start = new Date(inDate);
    const end = new Date(outDate);
    const days = Math.max(1, (end - start) / (1000 * 60 * 60 * 24));
    const total = days * price;

    const url = `print_receipt.jsp?id=${id}&name=${encodeURIComponent(name)}&room=${encodeURIComponent(room)}&in=${inDate}&out=${outDate}&price=${price}&total=${total}`;
    window.open(url, '_blank');
  }

  async function logout() {
    await fetch('logout');
    window.location.href = 'login_app.html';
  }
</script>

</body>
</html>