<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Confirm Booking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { height:100%; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #f0f8ff;
      overflow: hidden;
      position: relative;
    }

    /* Subtle animated background gradient */
    body::before {
      content: '';
      position: absolute;
      top:0; left:0; right:0; bottom:0;
      background: linear-gradient(270deg, #0f2027, #203a43, #2c5364, #0f2027);
      background-size: 800% 800%;
      animation: gradientShift 20s ease infinite;
      z-index:0;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      position: relative;
      z-index:1;
      width: 100%;
      max-width: 450px;
      padding: 30px;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    }

    h2 {
      font-size: 32px;
      margin-bottom: 25px;
      color: #00c6ff;
      text-shadow: 0 2px 8px rgba(0,150,255,0.4);
    }

    .summary {
      margin-bottom: 25px;
      font-size: 16px;
      line-height: 1.6;
      color: #dff6ff;
      text-align: left;
    }

    .summary p { margin-bottom: 8px; }
    .total-row {
      font-size: 1.3em;
      font-weight: bold;
      margin-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.3);
      padding-top: 10px;
      color: #00c6ff;
    }

    input {
      width: 100%;
      padding: 14px;
      margin-bottom: 14px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      color: #f0f8ff;
      font-size: 15px;
      transition: all 0.3s;
    }
    input:focus {
      outline:none;
      border-color: #00c6ff;
      box-shadow: 0 0 10px rgba(0,198,255,0.5);
    }

    button {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(0,198,255,0.3);
      margin-bottom: 10px;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0,198,255,0.5);
    }
    button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
      box-shadow: 0 6px 20px rgba(0,198,255,0.2);
    }

    .back-btn {
      display: block;
      text-decoration: none;
      color: #fff;
      background: rgba(255,255,255,0.1);
      padding: 12px;
      border-radius: 8px;
      transition: all 0.3s;
      font-size: 15px;
    }
    .back-btn:hover { background: rgba(0,198,255,0.3); }

    /* Mobile */
    @media(max-width:480px){
      .container { padding:25px; }
      h2 { font-size:26px; }
      input { padding:12px; font-size:14px; }
      button { padding:14px; font-size:15px; }
    }
  </style>
</head>

<body>

<div class="container">
  <h2>Confirm Booking</h2>

  <div class="summary">
    <p><strong>Room:</strong> <span id="sRoom"></span></p>
    <p><strong>Check-In:</strong> <span id="sIn"></span></p>
    <p><strong>Check-Out:</strong> <span id="sOut"></span></p>
    <p><strong>Duration:</strong> <span id="sDays"></span> nights</p>
    <p><strong>Price per Night:</strong> $<span id="sPrice"></span></p>
    <div class="total-row">TOTAL: $<span id="sTotal"></span></div>
  </div>

  <form onsubmit="confirmBooking(event)">
    <input type="text" id="name" placeholder="Guest Name" required>
    <input type="email" id="email" placeholder="Email Address" required>
    <input type="tel" id="phone" placeholder="Phone Number" required>
    <button type="submit" id="btn">Confirm & Pay</button>
  </form>

  <a href="receptionist_dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const pricePerNight = parseFloat(params.get('price'));
  const checkInDate = new Date(params.get('in'));
  const checkOutDate = new Date(params.get('out'));
  const diffTime = Math.abs(checkOutDate - checkInDate);
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  const totalAmount = diffDays * pricePerNight;

  document.getElementById('sRoom').innerText = params.get('room');
  document.getElementById('sIn').innerText = params.get('in');
  document.getElementById('sOut').innerText = params.get('out');
  document.getElementById('sDays').innerText = diffDays;
  document.getElementById('sPrice').innerText = pricePerNight.toFixed(2);
  document.getElementById('sTotal').innerText = totalAmount.toFixed(2);

  async function confirmBooking(e){
    e.preventDefault();
    const btn = document.getElementById('btn');
    btn.innerText = "Processing...";
    btn.disabled = true;

    const data = new URLSearchParams();
    data.append('roomId', params.get('id'));
    data.append('checkIn', params.get('in'));
    data.append('checkOut', params.get('out'));
    data.append('name', document.getElementById('name').value);
    data.append('email', document.getElementById('email').value);
    data.append('phone', document.getElementById('phone').value);
    data.append('totalPrice', totalAmount);

    try {
      const res = await fetch('bookRoom', { method:'POST', body:data });
      const json = await res.json();

      if(json.status === 'success'){
        const name = document.getElementById('name').value;
        const url = `print_receipt.html?id=${params.get('id')}&name=${encodeURIComponent(name)}&room=${params.get('room')}&in=${params.get('in')}&out=${params.get('out')}&price=${pricePerNight}&total=${totalAmount}`;
        window.location.href = url;
      } else {
        alert("Error: " + json.message);
        btn.disabled = false;
      }
    } catch(err){
      alert("Server Error");
      btn.disabled = false;
    }
  }
</script>

</body>
</html>
